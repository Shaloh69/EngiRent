# EngiRent Hub - Visual Process Flowcharts

## 1. COMPLETE USER JOURNEY - OWNER & RENTER

```mermaid
graph TB
    Start([Start: User Opens EngiRent Hub]) --> Login{Registered?}
    Login -->|No| Register[Register Account<br/>- Email verification<br/>- Face enrollment<br/>- Parent info<br/>- Student ID upload]
    Login -->|Yes| LoginAuth[Login<br/>- Email + Password<br/>- 2FA Optional]
    Register --> Dashboard
    LoginAuth --> Dashboard
    
    Dashboard{Select Role} -->|Owner| OwnerFlow[Owner Dashboard]
    Dashboard -->|Renter| RenterFlow[Renter Dashboard]
    
    %% OWNER FLOW
    OwnerFlow --> ListItem[List New Item<br/>- Upload photos<br/>- Set price<br/>- Set schedule]
    ListItem --> WaitRequest[Wait for Rental Request]
    WaitRequest --> RequestNotif[Receive Notification]
    RequestNotif --> ApproveDecision{Approve?}
    ApproveDecision -->|Yes| WaitPayment[Wait for Payment]
    ApproveDecision -->|No| RejectRequest[Reject Request] --> WaitRequest
    WaitPayment --> DepositNotif[Payment Received<br/>Notification]
    DepositNotif --> GoToKiosk1[Go to Kiosk]
    GoToKiosk1 --> ScanQR1[Scan QR Code]
    ScanQR1 --> FaceAuth1[Facial Recognition]
    FaceAuth1 --> LockerOpen1[Locker Opens]
    LockerOpen1 --> DepositItem[Place Item Inside]
    DepositItem --> AIVerify1[AI Camera Verifies Item]
    AIVerify1 --> VerifyResult1{Verified?}
    VerifyResult1 -->|Yes| PaymentRelease[Payment Released] --> OwnerWait[Wait for Return]
    VerifyResult1 -->|No| RetryDeposit{Retry < 10?}
    RetryDeposit -->|Yes| DepositItem
    RetryDeposit -->|No| CancelTxn1[Cancel Transaction<br/>Refund Renter] --> OwnerFlow
    OwnerWait --> ReturnNotif[Item Returned Notification]
    ReturnNotif --> GoToKiosk2[Go to Kiosk]
    GoToKiosk2 --> ScanQR2[Scan QR Code]
    ScanQR2 --> FaceAuth2[Facial Recognition]
    FaceAuth2 --> LockerOpen2[Locker Opens]
    LockerOpen2 --> RetrieveItem[Retrieve Item]
    RetrieveItem --> CheckCondition{Item OK?}
    CheckCondition -->|Yes| RateRenter[Rate Renter] --> OwnerEnd([End])
    CheckCondition -->|No| ReportDamage[Report Damage<br/>Penalty Applied] --> OwnerEnd
    
    %% RENTER FLOW
    RenterFlow --> BrowseItems[Browse Available Items<br/>- Filter by category<br/>- View details<br/>- Check ratings]
    BrowseItems --> SelectItem[Select Item]
    SelectItem --> RequestRental[Request Rental<br/>- Choose duration<br/>- Agree to T&C]
    RequestRental --> WaitApproval[Wait for Owner Approval]
    WaitApproval --> ApprovalNotif[Approval Notification]
    ApprovalNotif --> PayGCash[Pay via GCash<br/>Payment Held in Escrow]
    PayGCash --> WaitDeposit[Wait for Owner to Deposit]
    WaitDeposit --> ReadyNotif[Item Ready Notification<br/>1-hour claim window]
    ReadyNotif --> GoToKiosk3[Go to Kiosk]
    GoToKiosk3 --> ScanQR3[Scan QR Code]
    ScanQR3 --> FaceAuth3[Facial Recognition]
    FaceAuth3 --> LockerOpen3[Locker Opens]
    LockerOpen3 --> ClaimItem[Retrieve Item]
    ClaimItem --> UseItem[Use Item During Rental Period]
    UseItem --> Reminders[Receive Return Reminders<br/>- 24h before<br/>- 6h before<br/>- 1h before]
    Reminders --> GoToKiosk4[Go to Kiosk to Return]
    GoToKiosk4 --> ScanQR4[Scan QR Code]
    ScanQR4 --> FaceAuth4[Facial Recognition]
    FaceAuth4 --> LockerOpen4[Return Locker Opens]
    LockerOpen4 --> ReturnItem[Place Item Inside]
    ReturnItem --> AIVerify2[AI Camera Verifies Condition]
    AIVerify2 --> VerifyResult2{Same Condition?}
    VerifyResult2 -->|Yes| RateOwner[Rate Owner] --> RenterEnd([End])
    VerifyResult2 -->|No| PenaltyCharge[Damage Penalty Charged] --> RenterEnd
```

## 2. KIOSK TOUCHSCREEN INTERACTION FLOW

```mermaid
graph TD
    Start([User Approaches Kiosk]) --> Welcome[Welcome Screen<br/>Press to Continue]
    Welcome --> RoleSelect{Select Role}
    RoleSelect -->|Owner| OwnerOpt{Action?}
    RoleSelect -->|Renter| RenterOpt{Action?}
    
    OwnerOpt -->|Deposit Item| DepositFlow[Deposit Flow]
    OwnerOpt -->|Retrieve Item| RetrieveFlow[Retrieve Flow]
    RenterOpt -->|Claim Item| ClaimFlow[Claim Flow]
    RenterOpt -->|Return Item| ReturnFlow[Return Flow]
    
    DepositFlow --> LoginMethod{Login Method}
    RetrieveFlow --> LoginMethod
    ClaimFlow --> LoginMethod
    ReturnFlow --> LoginMethod
    
    LoginMethod -->|QR Code| ScanQR[Scan QR Code from App]
    LoginMethod -->|Email/Password| EnterCreds[Enter Credentials]
    
    ScanQR --> FaceRec[Facial Recognition]
    EnterCreds --> FaceRec
    
    FaceRec --> FaceMatch{Match?}
    FaceMatch -->|Yes| AuthSuccess[Authentication Successful]
    FaceMatch -->|No| RetryFace{Retry < 3?}
    RetryFace -->|Yes| FaceRec
    RetryFace -->|No| LockAccount[Account Locked<br/>Contact Admin] --> EndFail([End])
    
    AuthSuccess --> PaymentCheck{Payment<br/>Required?}
    PaymentCheck -->|Yes| ShowGCashQR[Display GCash QR Code]
    PaymentCheck -->|No| AssignLocker[Assign Locker Compartment]
    
    ShowGCashQR --> ScanWithGCash[User Scans with GCash App]
    ScanWithGCash --> VerifyPayment{Payment<br/>Confirmed?}
    VerifyPayment -->|Yes| AssignLocker
    VerifyPayment -->|No| PaymentFail[Payment Failed<br/>Try Again] --> ShowGCashQR
    
    AssignLocker --> DisplayLocker[Display Locker Number<br/>Locker #X Opening...]
    DisplayLocker --> OpenLocker[Solenoid Lock Releases]
    OpenLocker --> UserAction{User Action}
    
    UserAction -->|Deposit/Return| PlaceItem[User Places Item]
    UserAction -->|Claim/Retrieve| TakeItem[User Takes Item]
    
    PlaceItem --> AICamera[AI Camera Activates]
    TakeItem --> UserCloses[User Closes Door]
    
    AICamera --> CaptureImages[Capture Multiple Angles]
    CaptureImages --> ProcessAI[Process with YOLOv8]
    ProcessAI --> CompareDB[Compare with Database Images]
    CompareDB --> ConfidenceScore{Confidence<br/>Score?}
    
    ConfidenceScore -->|≥85%| VerifySuccess[Item Verified ✓]
    ConfidenceScore -->|60-84%| ManualReview[Manual Review Required<br/>Admin Notified]
    ConfidenceScore -->|<60%| VerifyFail[Verification Failed ✗]
    
    VerifyFail --> RetryCount{Retry < 10?}
    RetryCount -->|Yes| Reposition[Please Reposition Item] --> PlaceItem
    RetryCount -->|No| TxnCancel[Transaction Cancelled<br/>Refund Initiated] --> EndFail
    
    VerifySuccess --> UserCloses
    ManualReview --> UserCloses
    
    UserCloses --> LockClose[System Locks Compartment]
    LockClose --> Confirm[Confirmation Screen<br/>Transaction Successful!]
    Confirm --> Notifications[Send Notifications<br/>- Owner<br/>- Renter<br/>- Database Update]
    Notifications --> ThankYou[Thank You!<br/>You May Now Leave]
    ThankYou --> EndSuccess([End])
```

## 3. AI ITEM VERIFICATION DETAILED FLOW

```mermaid
graph TD
    Trigger([Item Placed in Locker]) --> Activate[AI Camera Activates]
    Activate --> Capture[Capture Multiple Photos<br/>- Front view<br/>- Top view<br/>- Side view<br/>- Close-up details]
    Capture --> Preprocess[Image Preprocessing<br/>- Resize to 640x640<br/>- Normalize colors<br/>- Adjust brightness<br/>- Remove background]
    
    Preprocess --> LoadModel[Load YOLOv8 Model]
    LoadModel --> Detect[Object Detection<br/>- Identify item boundaries<br/>- Segment from background]
    
    Detect --> Extract[Feature Extraction<br/>- Shape geometry<br/>- Color histogram<br/>- Texture patterns<br/>- Brand/text OCR<br/>- Size dimensions]
    
    Extract --> FetchDB[Fetch Original Listing Images<br/>from Database]
    FetchDB --> ExtractOriginal[Extract Features from<br/>Original Photos]
    
    ExtractOriginal --> Compare[Compare Feature Vectors<br/>- Visual similarity 80%<br/>- Metadata match 20%]
    
    Compare --> CalcScore[Calculate Confidence Score<br/>0-100%]
    
    CalcScore --> Decision{Confidence<br/>Level?}
    
    Decision -->|≥85%| HighConf[HIGH CONFIDENCE<br/>Item Verified ✓]
    Decision -->|60-84%| MedConf[MEDIUM CONFIDENCE<br/>Manual Review Required]
    Decision -->|<60%| LowConf[LOW CONFIDENCE<br/>Verification Failed ✗]
    
    HighConf --> ReleasePayment[Release Payment to Owner]
    ReleasePayment --> NotifyBoth1[Notify Owner & Renter<br/>Transaction Proceeding]
    NotifyBoth1 --> LogSuccess[Log Verification Success<br/>- Store images<br/>- Record score<br/>- Update ML model]
    LogSuccess --> End1([End: Success])
    
    MedConf --> HoldPayment[Hold Payment in Escrow]
    HoldPayment --> NotifyAdmin[Notify Admin for Review]
    NotifyAdmin --> AdminReview{Admin<br/>Decision}
    AdminReview -->|Approve| ReleasePayment
    AdminReview -->|Reject| RefundProcess
    
    LowConf --> IncrementRetry[Increment Retry Counter]
    IncrementRetry --> CheckRetries{Retry Count<br/>< 10?}
    
    CheckRetries -->|Yes| PromptUser[Prompt User:<br/>Please Reposition Item]
    PromptUser --> Capture
    
    CheckRetries -->|No| MaxRetries[Max Retries Reached]
    MaxRetries --> CancelTxn[Cancel Transaction]
    CancelTxn --> RefundProcess[Initiate Refund to Renter]
    RefundProcess --> NotifyBoth2[Notify Owner & Renter<br/>Verification Failed]
    NotifyBoth2 --> LogFailure[Log Verification Failure<br/>- Store failed images<br/>- Record attempts<br/>- Flag for analysis]
    LogFailure --> End2([End: Failure])
```

## 4. PAYMENT & NOTIFICATION FLOW

```mermaid
graph TD
    Start([Transaction Initiated]) --> PaymentType{Transaction<br/>Type?}
    
    PaymentType -->|Rental Request| RenterPay[Renter Pays via GCash]
    PaymentType -->|Late Fee| LatePay[Auto-Charge Late Fee]
    PaymentType -->|Damage Penalty| DamagePay[Auto-Charge Damage Penalty]
    
    RenterPay --> GCashAPI[GCash API Call]
    LatePay --> GCashAPI
    DamagePay --> GCashAPI
    
    GCashAPI --> PaymentSuccess{Payment<br/>Successful?}
    
    PaymentSuccess -->|Yes| Escrow[Hold Payment in Escrow<br/>Database: status=PENDING]
    PaymentSuccess -->|No| PaymentRetry{Retry?}
    
    PaymentRetry -->|Yes| GCashAPI
    PaymentRetry -->|No| PaymentFailed[Payment Failed<br/>Cancel Request]
    PaymentFailed --> NotifyPayFail[Notify User: Payment Failed]
    NotifyPayFail --> End1([End])
    
    Escrow --> NotifyOwner[Send Notification to Owner<br/>Payment Received<br/>Please Deposit Item]
    NotifyOwner --> WaitDeposit[Wait for Item Deposit]
    
    WaitDeposit --> DepositCheck{Item Deposited<br/>& Verified?}
    
    DepositCheck -->|Yes| ReleasePayment[Release Payment to Owner<br/>Database: status=COMPLETED]
    DepositCheck -->|No| TimeoutCheck{Timeout<br/>Exceeded?}
    
    TimeoutCheck -->|Yes| AutoRefund[Automatic Refund to Renter]
    TimeoutCheck -->|No| WaitDeposit
    
    ReleasePayment --> NotifyRelease[Notify Owner:<br/>Payment of ₱X Credited]
    NotifyRelease --> NotifyRenter[Notify Renter:<br/>Item Ready for Pickup]
    NotifyRenter --> UpdateDB[Update Database<br/>- Transaction log<br/>- Payment history<br/>- Item status]
    
    AutoRefund --> NotifyRefund[Notify Renter:<br/>Refund of ₱X Processed]
    NotifyRefund --> NotifyOwnerFail[Notify Owner:<br/>Deposit Timeout - Request Cancelled]
    NotifyOwnerFail --> UpdateDB
    
    UpdateDB --> End2([End])
    
    %% NOTIFICATION SUBSYSTEM
    NotifyOwner -.->|In-App| WebNotif[Web Push Notification]
    NotifyOwner -.->|Email| EmailNotif[Email Notification]
    NotifyOwner -.->|SMS| SMSNotif[SMS Notification Optional]
    
    WebNotif --> NotifLog[Log Notification<br/>- Timestamp<br/>- Delivery status]
    EmailNotif --> NotifLog
    SMSNotif --> NotifLog
```

## 5. LATE FEE & PENALTY SYSTEM

```mermaid
graph TD
    Start([Rental Period Active]) --> Monitor[System Monitors Return Deadline]
    Monitor --> CheckTime{Current Time<br/>vs Deadline?}
    
    CheckTime -->|24h before| Reminder1[Send Reminder 1:<br/>Return in 24 hours]
    CheckTime -->|6h before| Reminder2[Send Reminder 2:<br/>Return in 6 hours]
    CheckTime -->|1h before| Reminder3[Send Reminder 3:<br/>FINAL WARNING]
    CheckTime -->|On time| Reminder4[Send Reminder 4:<br/>Deadline is NOW]
    CheckTime -->|Overdue| OverdueDetect[OVERDUE DETECTED]
    
    Reminder1 --> Monitor
    Reminder2 --> Monitor
    Reminder3 --> Monitor
    Reminder4 --> Monitor
    
    OverdueDetect --> CalcLateFee[Calculate Late Fee<br/>₱X per hour/day]
    CalcLateFee --> NotifyLate[Notify Renter:<br/>LATE! Fee: ₱X<br/>Return ASAP]
    NotifyLate --> AccrueFee[Accrue Late Fee<br/>Database: pending_charges]
    
    AccrueFee --> StillLate{Still<br/>Overdue?}
    StillLate -->|Yes| WaitHour[Wait 1 Hour]
    WaitHour --> CalcLateFee
    StillLate -->|No| ItemReturned[Item Returned]
    
    ItemReturned --> AICheck[AI Verify Item Condition]
    AICheck --> ConditionResult{Item<br/>Condition?}
    
    ConditionResult -->|Same| ChargeLateFee[Charge Only Late Fee]
    ConditionResult -->|Damaged| ChargeBoth[Charge Late Fee +<br/>Damage Penalty]
    ConditionResult -->|Missing| ChargeFull[Charge Late Fee +<br/>Full Item Value]
    
    ChargeLateFee --> ProcessCharge1[Process GCash Charge]
    ChargeBoth --> ProcessCharge2[Process GCash Charge]
    ChargeFull --> ProcessCharge3[Process GCash Charge]
    
    ProcessCharge1 --> ChargeSuccess{Charge<br/>Successful?}
    ProcessCharge2 --> ChargeSuccess
    ProcessCharge3 --> ChargeSuccess
    
    ChargeSuccess -->|Yes| NotifyCharged[Notify Renter:<br/>₱X Charged<br/>Breakdown: ...]
    ChargeSuccess -->|No| PaymentFailed[Payment Failed]
    
    NotifyCharged --> CompensateOwner[Compensate Owner<br/>Transfer ₱X]
    PaymentFailed --> FlagAccount[Flag Account<br/>Restrict Future Rentals]
    
    CompensateOwner --> NotifyOwner[Notify Owner:<br/>₱X Compensation Received]
    FlagAccount --> NotifyAdmin[Notify Admin:<br/>Payment Collection Failed]
    
    NotifyOwner --> UpdateRecords1[Update Database<br/>- Payment log<br/>- User rating impact]
    NotifyAdmin --> UpdateRecords2[Update Database<br/>- Flag user<br/>- Debt recorded]
    
    UpdateRecords1 --> End1([End])
    UpdateRecords2 --> End2([End])
```

## 6. UNCLAIMED ITEM MANAGEMENT (CONVEYOR SYSTEM)

```mermaid
graph TD
    Start([Item Deposited in Locker]) --> StartTimer[Start 1-Hour Claim Timer]
    StartTimer --> Monitor[System Monitors Timer]
    
    Monitor --> CheckStatus{Item Status?}
    
    CheckStatus -->|Claimed| ItemClaimed[Renter Claimed Item]
    CheckStatus -->|1hr passed| Unclaimed[Item Unclaimed]
    CheckStatus -->|Timer running| WaitCheck[Wait & Check Every 5min]
    
    WaitCheck --> Monitor
    
    ItemClaimed --> StopTimer[Stop Timer]
    StopTimer --> End1([End: Normal Flow])
    
    Unclaimed --> NotifyBoth[Notify Owner & Renter<br/>Item Not Claimed]
    NotifyBoth --> ActivateConveyor[Activate Conveyor System]
    
    ActivateConveyor --> OpenPrimaryLocker[Open Primary Locker<br/>Where Item Was Deposited]
    OpenPrimaryLocker --> ConveyorMove[Conveyor Belt Moves Item]
    ConveyorMove --> OpenStorageLocker[Open Storage Locker<br/>Delayed Pickup Section]
    OpenStorageLocker --> TransferItem[Item Transferred to Storage]
    
    TransferItem --> CloseLockers[Close Both Lockers]
    CloseLockers --> UpdateDB[Update Database<br/>- Item location: STORAGE<br/>- Primary locker: AVAILABLE<br/>- Timestamp logged]
    
    UpdateDB --> NotifyUpdate[Notify Renter:<br/>Item Moved to Storage<br/>Visit Kiosk to Claim]
    NotifyUpdate --> WaitClaim[Wait for Claim<br/>Max 24 hours]
    
    WaitClaim --> ClaimCheck{Claimed from<br/>Storage?}
    
    ClaimCheck -->|Yes| ClaimedStorage[Renter Claims from Storage<br/>Same Auth Process]
    ClaimCheck -->|24hr passed| StillUnclaimed[Still Unclaimed After 24hr]
    
    ClaimedStorage --> FreeStorage[Free Storage Locker]
    FreeStorage --> End2([End: Claimed Late])
    
    StillUnclaimed --> EscalateAdmin[Escalate to Admin]
    EscalateAdmin --> ContactRenter[Admin Contacts Renter<br/>Final Warning]
    ContactRenter --> AdminDecision{Renter<br/>Response?}
    
    AdminDecision -->|Claims| ClaimedStorage
    AdminDecision -->|No response| CancelRental[Cancel Rental]
    
    CancelRental --> RefundPartial[Partial Refund to Renter<br/>Deduct Service Fee]
    RefundPartial --> ReturnToOwner[Notify Owner to Retrieve<br/>Item from Storage]
    ReturnToOwner --> OwnerRetrieves[Owner Retrieves Item]
    OwnerRetrieves --> FreeStorage
    
    FreeStorage --> End3([End: Rental Cancelled])
```

---

## LEGEND FOR FLOWCHARTS

**Shape Meanings:**
- `([Start/End])` - Terminal points
- `[Process]` - Action/Process step
- `{Decision?}` - Decision point (Yes/No branching)
- `[Notification]` - System notification
- `--->` - Sequential flow
- `-.->` - Asynchronous/parallel flow
